{% extends "admin/base_site.html" %}
{% load static %}

{% block extrahead %}
<!-- Bootstrap 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container my-4">
  <h1 class="mb-4 text-primary">ğŸ“Š Thá»‘ng kÃª doanh thu</h1>
  <form method="get" class="row g-3 mb-4">
    <div class="col-auto">
      <label for="year" class="col-form-label">Chá»n nÄƒm:</label>
    </div>
    <div class="col-auto">
      <input type="number" style="background-color: white; color: black;" min="2000" max="2100" step="1" name="year" id="year"
             value="{{ selected_year }}" class="form-control" placeholder="VD: 2024">
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">Lá»c theo nÄƒm</button>
    </div>
  </form>
  <!-- Tá»•ng quan -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card text-white bg-success mb-3">
        <div class="card-header">Tá»•ng doanh thu</div>
        <div class="card-body">
          <h4 class="card-title">{{ total_revenue|floatformat:0 }} Ä‘</h4>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-info mb-3">
        <div class="card-header">Sá»‘ giao dá»‹ch thÃ nh cÃ´ng</div>
        <div class="card-body">
          <h4 class="card-title">{{ total_count }}</h4>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-warning mb-3">
        <div class="card-header">Giao dá»‹ch trung bÃ¬nh</div>
        <div class="card-body">
          <h4 class="card-title">{{ avg_transaction|floatformat:0 }} Ä‘</h4>
        </div>
      </div>
    </div>
  </div>

  <!-- Tráº¡ng thÃ¡i thanh toÃ¡n -->
  <h4 class="mt-5">ğŸ” Tá»· lá»‡ tráº¡ng thÃ¡i thanh toÃ¡n</h4>
  <table class="table table-bordered mt-3 text-center">
    <thead class="table-light">
      <tr>
        <th>Tráº¡ng thÃ¡i</th>
        <th>Sá»‘ lÆ°á»£ng</th>
      </tr>
    </thead>
    <tbody>
      {% for status in status_distribution %}
      <tr>
        <td><strong>{{ status.status_name }}</strong></td>
        <td>{{ status.count }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- PhÆ°Æ¡ng thá»©c thanh toÃ¡n -->
  <h4 class="mt-5">ğŸ’³ Doanh thu theo phÆ°Æ¡ng thá»©c thanh toÃ¡n</h4>
  <table class="table table-bordered mt-3 text-center">
    <thead class="table-light">
      <tr>
        <th>PhÆ°Æ¡ng thá»©c</th>
        <th>Tá»•ng doanh thu</th>
        <th>Sá»‘ giao dá»‹ch</th>
      </tr>
    </thead>
    <tbody>
      {% for m in method_stats %}
      <tr>
        <td><strong>{{ m.method_name }}</strong></td>
        <td>{{ m.total|floatformat:0 }} Ä‘</td>
        <td>{{ m.count }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Biá»ƒu Ä‘á»“ -->
  <h4 class="mt-5">ğŸ“ˆ Biá»ƒu Ä‘á»“ doanh thu theo thÃ¡ng</h4>
  <div class="my-4">
    <canvas id="monthlyChart" height="100"></canvas>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('monthlyChart').getContext('2d');
  const monthlyChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ chart_labels|safe }},
      datasets: [{
        label: 'Doanh thu theo thÃ¡ng',
        data: {{ chart_data|safe }},
        backgroundColor: 'rgba(75, 192, 192, 0.6)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        title: {
          display: true,
          text: 'Thá»‘ng kÃª doanh thu theo thÃ¡ng'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Doanh thu (VNÄ)'
          }
        }
      }
    }
  });
</script>
{% endblock %}
