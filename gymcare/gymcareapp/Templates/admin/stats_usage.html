{% extends "admin/base_site.html" %}
{% load static %}

{% block extrahead %}
<!-- Th√™m Bootstrap 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container my-4">
  <h1 class="mb-4 text-primary">üìä Th·ªëng k√™ s·ª≠ d·ª•ng ph√≤ng t·∫≠p</h1>

  <!-- Form ch·ªçn ng√†y -->
  <form method="get" class="row g-3 mb-4">
    <div class="col-auto">
      <label for="date" class="col-form-label">Ch·ªçn ng√†y:</label>
    </div>
    <div class="col-auto">
      <input type="date" id="date" name="date" value="{{ current_date_input }}" class="form-control">
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-success">Xem</button>
    </div>
  </form>

  <h4 class="text-muted">Ng√†y: <strong>{{ current_date }}</strong></h4>

  <!-- B·∫£ng th·ªëng k√™ -->
  <div class="table-responsive my-4">
    <table class="table table-bordered table-hover align-middle text-center">
      <thead class="table-light">
        <tr>
          <th>Khung gi·ªù</th>
          <th>S·ªë l∆∞·ª£t ƒë·∫∑t</th>
          <th>Ho√†n th√†nh</th>
          <th>C√°c lo·∫°i h√¨nh t·∫≠p luy·ªán</th>
        </tr>
      </thead>
      <tbody>
        {% for stat in hourly_stats %}
        <tr>
          <td><strong>{{ stat.time_slot }}</strong></td>
          <td>{{ stat.total }}</td>
          <td>{{ stat.completed }}</td>
          <td class="text-start">
            <ul class="mb-0">
              {% for type, count in stat.types.items %}
              <li><strong>{{ type }}</strong>: {{ count }}</li>
              {% endfor %}
            </ul>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Gi·ªù cao ƒëi·ªÉm -->
  <h5 class="text-info">‚è∞ Gi·ªù cao ƒëi·ªÉm (nhi·ªÅu bu·ªïi t·∫≠p nh·∫•t):</h5>
  <ul>
    {% for hour in peak_hours %}
    <li><span class="badge bg-warning text-dark">{{ hour }}</span></li>
    {% endfor %}
  </ul>

  <!-- Bi·ªÉu ƒë·ªì -->
  <div class="my-5">
    <canvas id="usageChart" width="400" height="200"></canvas>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('usageChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ time_labels|safe }},
      datasets: [{
        label: 'S·ªë l∆∞·ª£t ƒë·∫∑t',
        data: {{ booked_counts|safe }},
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        title: {
          display: true,
          text: 'Bi·ªÉu ƒë·ªì l∆∞·ª£t ƒë·∫∑t theo khung gi·ªù'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          max: {{ capacity }},
          title: {
            display: true,
            text: 'S·ªë l∆∞·ª£t'
          }
        }
      }
    }
  });
</script>
{% endblock %}
