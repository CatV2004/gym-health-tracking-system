{% extends "admin/base_site.html" %}
{% load static %}

{% block extrahead %}
<!-- Th√™m Bootstrap 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container my-4">
  <h1 class="mb-4 text-primary">üìä Th·ªëng K√™ S·ªë L∆∞·ª£ng H·ªôi Vi√™n</h1>

  <!-- Form ch·ªçn th√°ng v√† nƒÉm -->
  <form method="get" class="row g-3 mb-4">
    <div class="col-auto">
      <label for="year" class="col-form-label">Ch·ªçn nƒÉm:</label>
    </div>
    <div class="col-auto">
      <input type="number" style="background-color: white; color: black;" id="year" name="year" value="{{ year }}" min="2000" class="form-control" placeholder="Nh·∫≠p nƒÉm">
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-info">Xem th·ªëng k√™</button>
    </div>
  </form>

  <!-- Hi·ªÉn th·ªã t·ªïng s·ªë th√†nh vi√™n -->
  <div class="mb-4">
    <p><strong>T·ªïng s·ªë th√†nh vi√™n:</strong> {{ total_member_count }}</p>
    <p><strong>S·ªë l∆∞·ª£ng th√†nh vi√™n nam:</strong> {{ total_male_count }}</p>
    <p><strong>S·ªë l∆∞·ª£ng th√†nh vi√™n n·ªØ:</strong> {{ total_female_count }}</p>
  </div>

  <!-- Bi·ªÉu ƒë·ªì s·ªë l∆∞·ª£ng th√†nh vi√™n theo th√°ng -->
  <h3 class="text-primary">S·ªë L∆∞·ª£ng Th√†nh Vi√™n Theo Th√°ng</h3>
  <div class="my-4">
    <canvas id="memberChart" width="400" height="200"></canvas>
  </div>

  <!-- Bi·ªÉu ƒë·ªì s·ªë l∆∞·ª£ng th√†nh vi√™n theo gi·ªõi t√≠nh -->
  <h3 class="text-primary">S·ªë L∆∞·ª£ng Th√†nh Vi√™n Theo Gi·ªõi T√≠nh v√† Th√°ng</h3>
  <div class="my-4">
    <canvas id="genderChart" width="400" height="200"></canvas>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  window.onload = function () {
    // Kh·ªüi t·∫°o c√°c m·∫£ng r·ªóng
    var memberData = [];
    var maleData = [];
    var femaleData = [];
    var months = [];

    // D√πng `push` ƒë·ªÉ th√™m t·ª´ng gi√° tr·ªã v√†o m·∫£ng
    {% for count in monthly_member_counts %}
      memberData.push({{ count }});
    {% endfor %}

    {% for count in male_member_counts %}
      maleData.push({{ count }});
    {% endfor %}

    {% for count in female_member_counts %}
      femaleData.push({{ count }});
    {% endfor %}

    {% for month in months %}
      months.push("{{ month }}");
    {% endfor %}

    // T·∫°o bi·ªÉu ƒë·ªì cho t·ªïng s·ªë th√†nh vi√™n
    const ctx = document.getElementById('memberChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: months,
        datasets: [{
          label: 'S·ªë l∆∞·ª£ng th√†nh vi√™n',
          data: memberData,
          backgroundColor: 'rgba(75, 192, 192, 0.6)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // T·∫°o bi·ªÉu ƒë·ªì cho s·ªë l∆∞·ª£ng th√†nh vi√™n theo gi·ªõi t√≠nh
    const genderCtx = document.getElementById('genderChart').getContext('2d');
    new Chart(genderCtx, {
      type: 'bar',
      data: {
        labels: months,
        datasets: [
          {
            label: 'S·ªë l∆∞·ª£ng th√†nh vi√™n nam',
            data: maleData,
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          },
          {
            label: 'S·ªë l∆∞·ª£ng th√†nh vi√™n n·ªØ',
            data: femaleData,
            backgroundColor: 'rgba(255, 99, 132, 0.6)',
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 1
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  };
</script>

{% endblock %}
